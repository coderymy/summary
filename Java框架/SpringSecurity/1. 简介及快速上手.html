<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/606746 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <meta name="content-class" content="yinxiang.markdown"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="696"/>

<div><span><div style="font-size: 14px; margin: 0; padding: 0; width: 100%;"><h1 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 41px; border-bottom: 3px double #999; color: #000; margin-top: 14px;">1. 简介及快速上手</h1>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">1.1 简要概述</h2>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">OAuth2允许不同的客户端通过认证和授权的方式来访问被其保护起来的资源</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">Spring OAuth2分为两部分，分别是OAuth2 Provider和OAuth2 Client</p>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">1.2 角色</h2>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">服务提供方</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">资源持有者</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">客户端</li>
</ul>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">1.3 OAuth2 Provider</h2>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">也就是进行授权的服务，一般都是进行生成token或者进行一些操作的，为其它服务的</p>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">1.5 快速开始</h2>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">1.5.1 案例分析</h3>
<blockquote style="line-height: 160%; box-sizing: content-box; margin: 15px 0; border-left: 4px solid #ddd; padding: 0 15px; color: #777;">
<ol style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal; margin-top: 0; margin-bottom: 0;">
<li style="line-height: 160%; box-sizing: content-box;">客户端向服务提供方请求token</li>
<li style="line-height: 160%; box-sizing: content-box;">服务提供方返回token</li>
</ol>
</blockquote>
<blockquote style="line-height: 160%; box-sizing: content-box; margin: 15px 0; border-left: 4px solid #ddd; padding: 0 15px; color: #777;">
<ol style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal; margin-top: 0; margin-bottom: 0;">
<li style="line-height: 160%; box-sizing: content-box;">客户端携带token去资源持有方请求资源</li>
<li style="line-height: 160%; box-sizing: content-box;">资源持有方携带token去服务提供方获取这个用户对应的权限信息</li>
<li style="line-height: 160%; box-sizing: content-box;">服务提供方返回给资源持有方这个用户的信息以及权限</li>
<li style="line-height: 160%; box-sizing: content-box;">资源持有方根据用户信息及权限返回给用户信息</li>
</ol>
</blockquote>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">1.5.2 编写Eureka Server</h3>
<h4 style="line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;">创建项目，编写依赖</h4>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">		<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
			<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>org.springframework.cloud<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>
			<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>
		<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>

</code></pre>
<h4 style="line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;">配置eureka_server</h4>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">server:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">  port:</span> <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">8761</span>

<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">eureka:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">  instance:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">    hostname:</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">localhost</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">  client:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">    register-with-eureka:</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">false</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">    fetch-registry:</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">false</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">    service-url:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">      defaultZone:</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">http://${eureka.instance.hostname}:${server.port}/eureka/</span>
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">在启动类上加上<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">@EnableEurekaServer</code>注解</p>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">1.5.3 编写service_auth</h3>
<h4 style="line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;">创建项目，编写依赖</h4>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">  <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>org.springframework.boot<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>
        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>org.springframework.boot<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>spring-boot-starter-web<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>
        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>org.springframework.cloud<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>
        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>org.springframework.security.oauth.boot<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>spring-security-oauth2-autoconfigure<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">version</span>&gt;</span>2.0.0.RELEASE<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">version</span>&gt;</span>
        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>org.springframework.cloud<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>spring-cloud-starter-security<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>
        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>

        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>mysql<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>mysql-connector-java<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">scope</span>&gt;</span>runtime<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">scope</span>&gt;</span>
        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>org.springframework.boot<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>spring-boot-starter-test<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">scope</span>&gt;</span>test<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">scope</span>&gt;</span>
        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
</code></pre>
<h4 style="line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;">配置文件信息</h4>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">spring:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">  application:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">    name:</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">service-auth</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">  datasource:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">    driver-class-name:</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">com.mysql.jdbc.Driver</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">    url:</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">jdbc:mysql://localhost:3306/ymy?useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=UTC</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">    username:</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">root</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">    password:</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">root</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">  jpa:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">    hibernate:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">      ddl-auto:</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">update</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">    show-sql:</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">true</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">server:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">  port:</span> <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">5000</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">  servlet:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">    context-path:</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">/uaa</span>

<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">eureka:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">  client:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">    service-url:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">      defaultZone:</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">http://localhost:8761/eureka/</span>
</code></pre>
<h4 style="line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;">配置SpringSecurity</h4>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">因为这个服务需要对外暴露检查<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Token</code>的<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">API</code>接口，所以这个服务也算是一个资源服务。所以需要使用<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">SpringSecurity</code></p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@Configuration</span>
<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@EnableWebSecurity</span><span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//开启web保护功能</span>
<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@EnableGlobalMethodSecurity</span>(prePostEnabled =<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">true</span>)<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//开启方法保护功能</span>
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">public</span> <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">WebSecurityConfig</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">extends</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">WebSecurityConfigurerAdapter</span> </span>{
    <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">/*
    * 1. 注入继承UserServiceDetail的service
    * 2. 配置权限信息
    * 3. 配置认证信息
    * */</span>
    <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@Autowired</span>
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">private</span> UserServiceDetail userServiceDetail;

    <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@Override</span>
    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">protected</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">configure</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(HttpSecurity http)</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">throws</span> Exception </span>{
        http.authorizeRequests().anyRequest().authenticated()
                .and()
                .csrf().disable();
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//这里配置了所有的请求都需要安全验证 </span>
    }

    <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@Override</span>
    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">protected</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">configure</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(AuthenticationManagerBuilder auth)</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">throws</span> Exception </span>{
        auth.userDetailsService(传入一个userServiceDetail).passwordEncoder(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">new</span> BCryptPasswordEncoder());
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//使用userServiceDetail做身份的认证并赋予权限，后面是将password进行加密</span>
    }
    <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@Bean</span><span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//加上这个注解</span>
    <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@Override</span>
    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">protected</span> AuthenticationManager <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">authenticationManagerBean</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">()</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">throws</span> Exception </span>{
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">super</span>.authenticationManager();
    }
}


</code></pre>
<h4 style="line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;">创建service</h4>
<ol style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal;">
<li style="line-height: 160%; box-sizing: content-box;">实现<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">UserDetailService</code></li>
<li style="line-height: 160%; box-sizing: content-box;">创建<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">loadUserByUsername</code>方法，</li>
<li style="line-height: 160%; box-sizing: content-box;">返回，使用username获取user</li>
</ol>
<h4 style="line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;">配置<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Authorization Server</code></h4>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">也就是配置启动类，在启动的时候启动一些资源</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@EnableResourceServer</span><span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//这个服务也需要对外暴露端口，所以也是一个资源服务器</span>
<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@EnableEurekaClient</span><span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//开启Eureka Client功能</span>
<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@SpringBootApplication</span>
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">public</span> <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">ServiceAuth2Application</span> </span>{
    <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@Autowired</span>
    <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@Qualifier</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;dataSource&quot;</span>)
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">private</span> DataSource dataSource;

    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">public</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">static</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">main</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(String[] args)</span> </span>{
        SpringApplication.run(ServiceAuth2Application.class, args);

    }

    <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@Configuration</span>
    <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@EnableAuthorizationServer</span><span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//开启授权服务</span>
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">protected</span> <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">OAuth2AuthorizationConfig</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">extends</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">AuthorizationServerConfigurerAdapter</span></span>{
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">/*
        * 需要配置三个选项
        * 1. ClientDetailsServiceConfigurer，配置客户端的一些基本信息
        * 2. AuthorizationServerEndpointsConfigurer
        * 3. AuthorizationServerSecurityConfigurer
        * */</span>
        JdbcTokenStore tokenStore=<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">new</span> JdbcTokenStore(dataSource);
        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@Autowired</span>
        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@Qualifier</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;authenticationManagerBean&quot;</span>)<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//在SpringSecurity中配置的</span>
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">private</span> AuthenticationManager authenticationManager;

        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@Autowired</span>
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">private</span> UserServiceDetail userServiceDetail;

        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@Override</span>
        <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">public</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">configure</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(ClientDetailsServiceConfigurer clients)</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">throws</span> Exception </span>{
            clients.inMemory()<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//将客户端的一些基本信息存储在内存中</span>
                    .withClient(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;browser&quot;</span>)<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//创建一个clientId为browser的客户端</span>
                    .authorizedGrantTypes(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;refresh_token&quot;</span>,<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;password&quot;</span>)<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//配置验证类型为refresh_token和password</span>
                    .scopes(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;ui&quot;</span>)<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//客户端域为ui</span>
                    .and()
                    .withClient(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;service-hi&quot;</span>)<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//下面是第二个客户端</span>
                    .secret(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;123456&quot;</span>)
                    .authorizedGrantTypes(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;client_credentials&quot;</span>,<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;refresh_token&quot;</span>,<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;password&quot;</span>)
                    .scopes(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;server&quot;</span>);
        }

        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@Override</span>
        <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">public</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">configure</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(AuthorizationServerEndpointsConfigurer endpoints)</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">throws</span> Exception </span>{
            <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">/*
            * 需要配置三项
            * 1. tokenStore，将token存储在内存中，
            * 2. authenticationManager，只有配置这个bean才会开启密码类型的验证
            * 3. userServiceDetail，用来读取用户的信息
            * */</span>
            endpoints.tokenStore(tokenStore)
                    .authenticationManager(authenticationManager)
                    .userDetailsService(userServiceDetail);
        }

        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@Override</span>
        <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">public</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">configure</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(AuthorizationServerSecurityConfigurer oauthServer)</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">throws</span> Exception </span>{
            <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">/*
            * 这里配置了获取Token的策略，这里配置获取Token不进行拦截，只需要验证Token的验证信息就好了
            * */</span>
            oauthServer
                    .tokenKeyAccess(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;permitAll()&quot;</span>)
                    .checkTokenAccess(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;isAuthenticated&quot;</span>)
                    .allowFormAuthenticationForClients()
                    .passwordEncoder(NoOpPasswordEncoder.getInstance());
        }
    }
}

</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">这样，对服务提供方的就完成了，<br/>
获取Token的方式</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">http://localhost:5000/uaa/oauth/token?username=xxx&amp;password=123456&amp;grant_type=password&amp;client_id=service-hi&amp;client_secret=123456
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">使用Token，可以直接在请求资源的时候在Header中携带上一个键值对<br/>
键：Authorization<br/>
值就是对应的Token</p>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">1.5.4 编写service_hi</h3>
<h4 style="line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;">创建项目，导入模块</h4>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>org.springframework.boot<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>
        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>org.springframework.boot<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>spring-boot-starter-web<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>
        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>org.springframework.cloud<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>
        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>org.springframework.cloud<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>
        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">&lt;!--作为资源服务器--&gt;</span>
        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>org.springframework.cloud<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>spring-cloud-starter-security<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">version</span>&gt;</span>2.1.4.RELEASE<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">version</span>&gt;</span>
        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>org.springframework.security.oauth.boot<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>spring-security-oauth2-autoconfigure<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">version</span>&gt;</span>2.1.4.RELEASE<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">version</span>&gt;</span>
        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>mysql<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>mysql-connector-java<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">scope</span>&gt;</span>runtime<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">scope</span>&gt;</span>
        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>org.springframework.boot<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>spring-boot-starter-test<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>
            <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">scope</span>&gt;</span>test<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">scope</span>&gt;</span>
        <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
</code></pre>
<h4 style="line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;">配置一些基本信息系</h4>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">eureka:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">  client:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">    service-url:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">      defaultZone:</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">http://localhost:8761/eureka/</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">server:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">  port:</span> <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">8762</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">spring:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">  application:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">    name:</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">service-hi</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">  datasource:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">    driver-class-name:</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">com.mysql.jdbc.Driver</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">    url:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">    username:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">    password:</span>

<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">  jpa:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">    hibernate:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">      ddl-auto:</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">update</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">    show-sql:</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">true</span>
<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">#    下面的配置需要和服务提供者auth中的配置保持一致，需要与之一一对应</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">security:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">  oauth2:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">    resource:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">      user-info-uri:</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">http://localhost:5000/uaa/users/current</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">    client:</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">      client-id:</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">service-hi</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">      client-secret:</span> <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">123456</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">      access-token-uri:</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">http://localhost:5000/uaa/oauth/token</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">      grant-type:</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">client_credentials,password</span>
<span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">      scope:</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">server</span>

</code></pre>
<h4 style="line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;">配置Resource  Server</h4>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">service-hi作为资源服务，需要配置Resource Server的相关配置</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">
<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@Configuration</span>
<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@EnableResourceServer</span><span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//开启Resource Server功能</span>
<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@EnableGlobalMethodSecurity</span>(prePostEnabled = <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">true</span>)<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//开启方法级别的保护</span>
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">public</span> <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">ResourceServerConfigurer</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">extends</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">ResourceServerConfigurerAdapter</span> </span>{
    <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@Override</span>
    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">public</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">configure</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(HttpSecurity http)</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">throws</span> Exception </span>{

        http.authorizeRequests()
                .antMatchers(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;/user/registry&quot;</span>).permitAll()
                .anyRequest().authenticated();<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//这里配置的是/user/registry/的请求不需要验证，其它的都需要验证</span>
    }
}
</code></pre>
<h4 style="line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;">配置OAuth2 Client</h4>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">
<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@EnableOAuth</span>2Client
<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@EnableConfigurationProperties</span>
<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@Configuration</span>
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">public</span> <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">OAuthClientConfig</span> </span>{
    <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">/*
     *1. 配置受保护的资源的信息
     *2. 配置一个过滤器，存储当前请求和上下文
     *3. Request域中创建AccessTokenRequest类型的Bean
     * */</span>
    <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@Bean</span>
    <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@ConfigurationProperties</span>(prefix = <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;security.oauth2.client&quot;</span>)
    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">public</span> ClientCredentialsResourceDetails <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">clientCredentialsResourceDetails</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">()</span> </span>{
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">new</span> ClientCredentialsResourceDetails();
    }

    <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@Bean</span>
    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">public</span> RequestInterceptor <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">oauth2FeignRequestInterceptor</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">()</span> </span>{
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">new</span> OAuth2FeignRequestInterceptor(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">new</span> DefaultOAuth2ClientContext(), clientCredentialsResourceDetails());
    }

    <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@Bean</span>
    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">public</span> OAuth2RestTemplate <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">clientCredentialsRestTemplate</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">()</span> </span>{
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">new</span> OAuth2RestTemplate(clientCredentialsResourceDetails());
    }

}

</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">这样基本的配置信息就完成了</p>
</div><center style="display:none !important;visibility:collapse !important;height:0 !important;white-space:nowrap;width:100%;overflow:hidden">%23%201.%20%E7%AE%80%E4%BB%8B%E5%8F%8A%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B%0A%0A%23%23%201.1%20%E7%AE%80%E8%A6%81%E6%A6%82%E8%BF%B0%0A%0AOAuth2%E5%85%81%E8%AE%B8%E4%B8%8D%E5%90%8C%E7%9A%84%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%80%9A%E8%BF%87%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9D%A5%E8%AE%BF%E9%97%AE%E8%A2%AB%E5%85%B6%E4%BF%9D%E6%8A%A4%E8%B5%B7%E6%9D%A5%E7%9A%84%E8%B5%84%E6%BA%90%0A%0ASpring%20OAuth2%E5%88%86%E4%B8%BA%E4%B8%A4%E9%83%A8%E5%88%86%EF%BC%8C%E5%88%86%E5%88%AB%E6%98%AFOAuth2%20Provider%E5%92%8COAuth2%20Client%0A%0A%23%23%201.2%20%E8%A7%92%E8%89%B2%0A%0A%2B%20%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E6%96%B9%0A%2B%20%E8%B5%84%E6%BA%90%E6%8C%81%E6%9C%89%E8%80%85%0A%2B%20%E5%AE%A2%E6%88%B7%E7%AB%AF%0A%0A%23%23%201.3%20OAuth2%20Provider%0A%0A%E4%B9%9F%E5%B0%B1%E6%98%AF%E8%BF%9B%E8%A1%8C%E6%8E%88%E6%9D%83%E7%9A%84%E6%9C%8D%E5%8A%A1%EF%BC%8C%E4%B8%80%E8%88%AC%E9%83%BD%E6%98%AF%E8%BF%9B%E8%A1%8C%E7%94%9F%E6%88%90token%E6%88%96%E8%80%85%E8%BF%9B%E8%A1%8C%E4%B8%80%E4%BA%9B%E6%93%8D%E4%BD%9C%E7%9A%84%EF%BC%8C%E4%B8%BA%E5%85%B6%E5%AE%83%E6%9C%8D%E5%8A%A1%E7%9A%84%0A%0A%0A%0A%0A%0A%0A%0A%23%23%201.5%20%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B%0A%0A%23%23%23%201.5.1%20%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90%0A%0A%3E1.%20%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%90%91%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E6%96%B9%E8%AF%B7%E6%B1%82token%0A%3E2.%20%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E6%96%B9%E8%BF%94%E5%9B%9Etoken%0A%0A%3E1.%20%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%90%BA%E5%B8%A6token%E5%8E%BB%E8%B5%84%E6%BA%90%E6%8C%81%E6%9C%89%E6%96%B9%E8%AF%B7%E6%B1%82%E8%B5%84%E6%BA%90%0A%3E2.%20%E8%B5%84%E6%BA%90%E6%8C%81%E6%9C%89%E6%96%B9%E6%90%BA%E5%B8%A6token%E5%8E%BB%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E6%96%B9%E8%8E%B7%E5%8F%96%E8%BF%99%E4%B8%AA%E7%94%A8%E6%88%B7%E5%AF%B9%E5%BA%94%E7%9A%84%E6%9D%83%E9%99%90%E4%BF%A1%E6%81%AF%0A%3E3.%20%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E6%96%B9%E8%BF%94%E5%9B%9E%E7%BB%99%E8%B5%84%E6%BA%90%E6%8C%81%E6%9C%89%E6%96%B9%E8%BF%99%E4%B8%AA%E7%94%A8%E6%88%B7%E7%9A%84%E4%BF%A1%E6%81%AF%E4%BB%A5%E5%8F%8A%E6%9D%83%E9%99%90%0A%3E4.%20%E8%B5%84%E6%BA%90%E6%8C%81%E6%9C%89%E6%96%B9%E6%A0%B9%E6%8D%AE%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E5%8F%8A%E6%9D%83%E9%99%90%E8%BF%94%E5%9B%9E%E7%BB%99%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%0A%0A%23%23%23%201.5.2%20%E7%BC%96%E5%86%99Eureka%20Server%0A%23%23%23%23%20%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE%EF%BC%8C%E7%BC%96%E5%86%99%E4%BE%9D%E8%B5%96%0A%60%60%60xml%0A%09%09%3Cdependency%3E%0A%09%09%09%3CgroupId%3Eorg.springframework.cloud%3C%2FgroupId%3E%0A%09%09%09%3CartifactId%3Espring-cloud-starter-netflix-eureka-server%3C%2FartifactId%3E%0A%09%09%3C%2Fdependency%3E%0A%0A%60%60%60%0A%23%23%23%23%20%E9%85%8D%E7%BD%AEeureka_server%0A%0A%60%60%60yaml%0Aserver%3A%0A%20%20port%3A%208761%0A%0Aeureka%3A%0A%20%20instance%3A%0A%20%20%20%20hostname%3A%20localhost%0A%20%20client%3A%0A%20%20%20%20register-with-eureka%3A%20false%0A%20%20%20%20fetch-registry%3A%20false%0A%20%20%20%20service-url%3A%0A%20%20%20%20%20%20defaultZone%3A%20http%3A%2F%2F%24%7Beureka.instance.hostname%7D%3A%24%7Bserver.port%7D%2Feureka%2F%0A%60%60%60%0A%E5%9C%A8%E5%90%AF%E5%8A%A8%E7%B1%BB%E4%B8%8A%E5%8A%A0%E4%B8%8A%60%40EnableEurekaServer%60%E6%B3%A8%E8%A7%A3%0A%0A%23%23%23%201.5.3%20%E7%BC%96%E5%86%99service_auth%0A%0A%23%23%23%23%20%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE%EF%BC%8C%E7%BC%96%E5%86%99%E4%BE%9D%E8%B5%96%0A%60%60%60xml%0A%20%20%3Cdependency%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.springframework.boot%3C%2FgroupId%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Espring-boot-starter-data-jpa%3C%2FartifactId%3E%0A%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%0A%20%20%20%20%20%20%20%20%3Cdependency%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.springframework.boot%3C%2FgroupId%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Espring-boot-starter-web%3C%2FartifactId%3E%0A%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%0A%20%20%20%20%20%20%20%20%3Cdependency%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.springframework.cloud%3C%2FgroupId%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Espring-cloud-starter-netflix-eureka-client%3C%2FartifactId%3E%0A%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%0A%20%20%20%20%20%20%20%20%3Cdependency%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.springframework.security.oauth.boot%3C%2FgroupId%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Espring-security-oauth2-autoconfigure%3C%2FartifactId%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3Cversion%3E2.0.0.RELEASE%3C%2Fversion%3E%0A%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%0A%20%20%20%20%20%20%20%20%3Cdependency%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.springframework.cloud%3C%2FgroupId%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Espring-cloud-starter-security%3C%2FartifactId%3E%0A%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%0A%0A%20%20%20%20%20%20%20%20%3Cdependency%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Emysql%3C%2FgroupId%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Emysql-connector-java%3C%2FartifactId%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3Cscope%3Eruntime%3C%2Fscope%3E%0A%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%0A%20%20%20%20%20%20%20%20%3Cdependency%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.springframework.boot%3C%2FgroupId%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Espring-boot-starter-test%3C%2FartifactId%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3Cscope%3Etest%3C%2Fscope%3E%0A%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%0A%60%60%60%0A%0A%0A%23%23%23%23%20%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BF%A1%E6%81%AF%0A%0A%60%60%60yaml%0A%0Aspring%3A%0A%20%20application%3A%0A%20%20%20%20name%3A%20service-auth%0A%20%20datasource%3A%0A%20%20%20%20driver-class-name%3A%20com.mysql.jdbc.Driver%0A%20%20%20%20url%3A%20jdbc%3Amysql%3A%2F%2Flocalhost%3A3306%2Fymy%3FuseUnicode%3Dtrue%26characterEncoding%3Dutf8%26serverTimezone%3DUTC%0A%20%20%20%20username%3A%20root%0A%20%20%20%20password%3A%20root%0A%20%20jpa%3A%0A%20%20%20%20hibernate%3A%0A%20%20%20%20%20%20ddl-auto%3A%20update%0A%20%20%20%20show-sql%3A%20true%0Aserver%3A%0A%20%20port%3A%205000%0A%20%20servlet%3A%0A%20%20%20%20context-path%3A%20%2Fuaa%0A%0Aeureka%3A%0A%20%20client%3A%0A%20%20%20%20service-url%3A%0A%20%20%20%20%20%20defaultZone%3A%20http%3A%2F%2Flocalhost%3A8761%2Feureka%2F%0A%60%60%60%0A%0A%23%23%23%23%20%E9%85%8D%E7%BD%AESpringSecurity%0A%0A%E5%9B%A0%E4%B8%BA%E8%BF%99%E4%B8%AA%E6%9C%8D%E5%8A%A1%E9%9C%80%E8%A6%81%E5%AF%B9%E5%A4%96%E6%9A%B4%E9%9C%B2%E6%A3%80%E6%9F%A5%60Token%60%E7%9A%84%60API%60%E6%8E%A5%E5%8F%A3%EF%BC%8C%E6%89%80%E4%BB%A5%E8%BF%99%E4%B8%AA%E6%9C%8D%E5%8A%A1%E4%B9%9F%E7%AE%97%E6%98%AF%E4%B8%80%E4%B8%AA%E8%B5%84%E6%BA%90%E6%9C%8D%E5%8A%A1%E3%80%82%E6%89%80%E4%BB%A5%E9%9C%80%E8%A6%81%E4%BD%BF%E7%94%A8%60SpringSecurity%60%0A%0A%60%60%60java%0A%40Configuration%0A%40EnableWebSecurity%2F%2F%E5%BC%80%E5%90%AFweb%E4%BF%9D%E6%8A%A4%E5%8A%9F%E8%83%BD%0A%40EnableGlobalMethodSecurity(prePostEnabled%20%3Dtrue)%2F%2F%E5%BC%80%E5%90%AF%E6%96%B9%E6%B3%95%E4%BF%9D%E6%8A%A4%E5%8A%9F%E8%83%BD%0Apublic%20class%20WebSecurityConfig%20extends%20WebSecurityConfigurerAdapter%20%7B%0A%20%20%20%20%2F*%0A%20%20%20%20*%201.%20%E6%B3%A8%E5%85%A5%E7%BB%A7%E6%89%BFUserServiceDetail%E7%9A%84service%0A%20%20%20%20*%202.%20%E9%85%8D%E7%BD%AE%E6%9D%83%E9%99%90%E4%BF%A1%E6%81%AF%0A%20%20%20%20*%203.%20%E9%85%8D%E7%BD%AE%E8%AE%A4%E8%AF%81%E4%BF%A1%E6%81%AF%0A%20%20%20%20*%20*%2F%0A%20%20%20%20%40Autowired%0A%20%20%20%20private%20UserServiceDetail%20userServiceDetail%3B%0A%0A%20%20%20%20%40Override%0A%20%20%20%20protected%20void%20configure(HttpSecurity%20http)%20throws%20Exception%20%7B%0A%20%20%20%20%20%20%20%20http.authorizeRequests().anyRequest().authenticated()%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.and()%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.csrf().disable()%3B%0A%20%20%20%20%20%20%20%20%2F%2F%E8%BF%99%E9%87%8C%E9%85%8D%E7%BD%AE%E4%BA%86%E6%89%80%E6%9C%89%E7%9A%84%E8%AF%B7%E6%B1%82%E9%83%BD%E9%9C%80%E8%A6%81%E5%AE%89%E5%85%A8%E9%AA%8C%E8%AF%81%20%0A%20%20%20%20%7D%0A%0A%20%20%20%20%40Override%0A%20%20%20%20protected%20void%20configure(AuthenticationManagerBuilder%20auth)%20throws%20Exception%20%7B%0A%20%20%20%20%20%20%20%20auth.userDetailsService(%E4%BC%A0%E5%85%A5%E4%B8%80%E4%B8%AAuserServiceDetail).passwordEncoder(new%20BCryptPasswordEncoder())%3B%0A%20%20%20%20%20%20%20%20%2F%2F%E4%BD%BF%E7%94%A8userServiceDetail%E5%81%9A%E8%BA%AB%E4%BB%BD%E7%9A%84%E8%AE%A4%E8%AF%81%E5%B9%B6%E8%B5%8B%E4%BA%88%E6%9D%83%E9%99%90%EF%BC%8C%E5%90%8E%E9%9D%A2%E6%98%AF%E5%B0%86password%E8%BF%9B%E8%A1%8C%E5%8A%A0%E5%AF%86%0A%20%20%20%20%7D%0A%20%20%20%20%40Bean%2F%2F%E5%8A%A0%E4%B8%8A%E8%BF%99%E4%B8%AA%E6%B3%A8%E8%A7%A3%0A%20%20%20%20%40Override%0A%20%20%20%20protected%20AuthenticationManager%20authenticationManagerBean()%20throws%20Exception%20%7B%0A%20%20%20%20%20%20%20%20return%20super.authenticationManager()%3B%0A%20%20%20%20%7D%0A%7D%0A%0A%0A%60%60%60%0A%0A%23%23%23%23%20%E5%88%9B%E5%BB%BAservice%0A1.%20%E5%AE%9E%E7%8E%B0%60UserDetailService%60%0A2.%20%E5%88%9B%E5%BB%BA%60loadUserByUsername%60%E6%96%B9%E6%B3%95%EF%BC%8C%0A3.%20%E8%BF%94%E5%9B%9E%EF%BC%8C%E4%BD%BF%E7%94%A8username%E8%8E%B7%E5%8F%96user%0A%0A%23%23%23%23%20%E9%85%8D%E7%BD%AE%60Authorization%20Server%60%0A%0A%E4%B9%9F%E5%B0%B1%E6%98%AF%E9%85%8D%E7%BD%AE%E5%90%AF%E5%8A%A8%E7%B1%BB%EF%BC%8C%E5%9C%A8%E5%90%AF%E5%8A%A8%E7%9A%84%E6%97%B6%E5%80%99%E5%90%AF%E5%8A%A8%E4%B8%80%E4%BA%9B%E8%B5%84%E6%BA%90%0A%0A%60%60%60java%0A%40EnableResourceServer%2F%2F%E8%BF%99%E4%B8%AA%E6%9C%8D%E5%8A%A1%E4%B9%9F%E9%9C%80%E8%A6%81%E5%AF%B9%E5%A4%96%E6%9A%B4%E9%9C%B2%E7%AB%AF%E5%8F%A3%EF%BC%8C%E6%89%80%E4%BB%A5%E4%B9%9F%E6%98%AF%E4%B8%80%E4%B8%AA%E8%B5%84%E6%BA%90%E6%9C%8D%E5%8A%A1%E5%99%A8%0A%40EnableEurekaClient%2F%2F%E5%BC%80%E5%90%AFEureka%20Client%E5%8A%9F%E8%83%BD%0A%40SpringBootApplication%0Apublic%20class%20ServiceAuth2Application%20%7B%0A%20%20%20%20%40Autowired%0A%20%20%20%20%40Qualifier(%22dataSource%22)%0A%20%20%20%20private%20DataSource%20dataSource%3B%0A%0A%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20%7B%0A%20%20%20%20%20%20%20%20SpringApplication.run(ServiceAuth2Application.class%2C%20args)%3B%0A%0A%20%20%20%20%7D%0A%0A%20%20%20%20%40Configuration%0A%20%20%20%20%40EnableAuthorizationServer%2F%2F%E5%BC%80%E5%90%AF%E6%8E%88%E6%9D%83%E6%9C%8D%E5%8A%A1%0A%20%20%20%20protected%20class%20OAuth2AuthorizationConfig%20extends%20AuthorizationServerConfigurerAdapter%7B%0A%20%20%20%20%20%20%20%20%2F*%0A%20%20%20%20%20%20%20%20*%20%E9%9C%80%E8%A6%81%E9%85%8D%E7%BD%AE%E4%B8%89%E4%B8%AA%E9%80%89%E9%A1%B9%0A%20%20%20%20%20%20%20%20*%201.%20ClientDetailsServiceConfigurer%EF%BC%8C%E9%85%8D%E7%BD%AE%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF%0A%20%20%20%20%20%20%20%20*%202.%20AuthorizationServerEndpointsConfigurer%0A%20%20%20%20%20%20%20%20*%203.%20AuthorizationServerSecurityConfigurer%0A%20%20%20%20%20%20%20%20*%20*%2F%0A%20%20%20%20%20%20%20%20JdbcTokenStore%20tokenStore%3Dnew%20JdbcTokenStore(dataSource)%3B%0A%20%20%20%20%20%20%20%20%40Autowired%0A%20%20%20%20%20%20%20%20%40Qualifier(%22authenticationManagerBean%22)%2F%2F%E5%9C%A8SpringSecurity%E4%B8%AD%E9%85%8D%E7%BD%AE%E7%9A%84%0A%20%20%20%20%20%20%20%20private%20AuthenticationManager%20authenticationManager%3B%0A%0A%20%20%20%20%20%20%20%20%40Autowired%0A%20%20%20%20%20%20%20%20private%20UserServiceDetail%20userServiceDetail%3B%0A%0A%20%20%20%20%20%20%20%20%40Override%0A%20%20%20%20%20%20%20%20public%20void%20configure(ClientDetailsServiceConfigurer%20clients)%20throws%20Exception%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20clients.inMemory()%2F%2F%E5%B0%86%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF%E5%AD%98%E5%82%A8%E5%9C%A8%E5%86%85%E5%AD%98%E4%B8%AD%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.withClient(%22browser%22)%2F%2F%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAclientId%E4%B8%BAbrowser%E7%9A%84%E5%AE%A2%E6%88%B7%E7%AB%AF%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.authorizedGrantTypes(%22refresh_token%22%2C%22password%22)%2F%2F%E9%85%8D%E7%BD%AE%E9%AA%8C%E8%AF%81%E7%B1%BB%E5%9E%8B%E4%B8%BArefresh_token%E5%92%8Cpassword%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.scopes(%22ui%22)%2F%2F%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%9F%9F%E4%B8%BAui%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.and()%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.withClient(%22service-hi%22)%2F%2F%E4%B8%8B%E9%9D%A2%E6%98%AF%E7%AC%AC%E4%BA%8C%E4%B8%AA%E5%AE%A2%E6%88%B7%E7%AB%AF%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.secret(%22123456%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.authorizedGrantTypes(%22client_credentials%22%2C%22refresh_token%22%2C%22password%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.scopes(%22server%22)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%40Override%0A%20%20%20%20%20%20%20%20public%20void%20configure(AuthorizationServerEndpointsConfigurer%20endpoints)%20throws%20Exception%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F*%0A%20%20%20%20%20%20%20%20%20%20%20%20*%20%E9%9C%80%E8%A6%81%E9%85%8D%E7%BD%AE%E4%B8%89%E9%A1%B9%0A%20%20%20%20%20%20%20%20%20%20%20%20*%201.%20tokenStore%EF%BC%8C%E5%B0%86token%E5%AD%98%E5%82%A8%E5%9C%A8%E5%86%85%E5%AD%98%E4%B8%AD%EF%BC%8C%0A%20%20%20%20%20%20%20%20%20%20%20%20*%202.%20authenticationManager%EF%BC%8C%E5%8F%AA%E6%9C%89%E9%85%8D%E7%BD%AE%E8%BF%99%E4%B8%AAbean%E6%89%8D%E4%BC%9A%E5%BC%80%E5%90%AF%E5%AF%86%E7%A0%81%E7%B1%BB%E5%9E%8B%E7%9A%84%E9%AA%8C%E8%AF%81%0A%20%20%20%20%20%20%20%20%20%20%20%20*%203.%20userServiceDetail%EF%BC%8C%E7%94%A8%E6%9D%A5%E8%AF%BB%E5%8F%96%E7%94%A8%E6%88%B7%E7%9A%84%E4%BF%A1%E6%81%AF%0A%20%20%20%20%20%20%20%20%20%20%20%20*%20*%2F%0A%20%20%20%20%20%20%20%20%20%20%20%20endpoints.tokenStore(tokenStore)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.authenticationManager(authenticationManager)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.userDetailsService(userServiceDetail)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%40Override%0A%20%20%20%20%20%20%20%20public%20void%20configure(AuthorizationServerSecurityConfigurer%20oauthServer)%20throws%20Exception%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F*%0A%20%20%20%20%20%20%20%20%20%20%20%20*%20%E8%BF%99%E9%87%8C%E9%85%8D%E7%BD%AE%E4%BA%86%E8%8E%B7%E5%8F%96Token%E7%9A%84%E7%AD%96%E7%95%A5%EF%BC%8C%E8%BF%99%E9%87%8C%E9%85%8D%E7%BD%AE%E8%8E%B7%E5%8F%96Token%E4%B8%8D%E8%BF%9B%E8%A1%8C%E6%8B%A6%E6%88%AA%EF%BC%8C%E5%8F%AA%E9%9C%80%E8%A6%81%E9%AA%8C%E8%AF%81Token%E7%9A%84%E9%AA%8C%E8%AF%81%E4%BF%A1%E6%81%AF%E5%B0%B1%E5%A5%BD%E4%BA%86%0A%20%20%20%20%20%20%20%20%20%20%20%20*%20*%2F%0A%20%20%20%20%20%20%20%20%20%20%20%20oauthServer%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.tokenKeyAccess(%22permitAll()%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.checkTokenAccess(%22isAuthenticated%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.allowFormAuthenticationForClients()%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.passwordEncoder(NoOpPasswordEncoder.getInstance())%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%7D%0A%0A%60%60%60%0A%E8%BF%99%E6%A0%B7%EF%BC%8C%E5%AF%B9%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E6%96%B9%E7%9A%84%E5%B0%B1%E5%AE%8C%E6%88%90%E4%BA%86%EF%BC%8C%0A%E8%8E%B7%E5%8F%96Token%E7%9A%84%E6%96%B9%E5%BC%8F%0A%60%60%60%0Ahttp%3A%2F%2Flocalhost%3A5000%2Fuaa%2Foauth%2Ftoken%3Fusername%3Dxxx%26password%3D123456%26grant_type%3Dpassword%26client_id%3Dservice-hi%26client_secret%3D123456%0A%60%60%60%0A%E4%BD%BF%E7%94%A8Token%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E5%9C%A8%E8%AF%B7%E6%B1%82%E8%B5%84%E6%BA%90%E7%9A%84%E6%97%B6%E5%80%99%E5%9C%A8Header%E4%B8%AD%E6%90%BA%E5%B8%A6%E4%B8%8A%E4%B8%80%E4%B8%AA%E9%94%AE%E5%80%BC%E5%AF%B9%0A%E9%94%AE%EF%BC%9AAuthorization%0A%E5%80%BC%E5%B0%B1%E6%98%AF%E5%AF%B9%E5%BA%94%E7%9A%84Token%0A%0A%23%23%23%201.5.4%20%E7%BC%96%E5%86%99service_hi%0A%0A%23%23%23%23%20%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE%EF%BC%8C%E5%AF%BC%E5%85%A5%E6%A8%A1%E5%9D%97%0A%0A%60%60%60xml%0A%20%20%20%20%20%20%20%20%3Cdependency%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.springframework.boot%3C%2FgroupId%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Espring-boot-starter-data-jpa%3C%2FartifactId%3E%0A%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%0A%20%20%20%20%20%20%20%20%3Cdependency%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.springframework.boot%3C%2FgroupId%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Espring-boot-starter-web%3C%2FartifactId%3E%0A%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%0A%20%20%20%20%20%20%20%20%3Cdependency%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.springframework.cloud%3C%2FgroupId%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Espring-cloud-starter-netflix-eureka-client%3C%2FartifactId%3E%0A%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%0A%20%20%20%20%20%20%20%20%3Cdependency%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.springframework.cloud%3C%2FgroupId%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Espring-cloud-starter-openfeign%3C%2FartifactId%3E%0A%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%0A%20%20%20%20%20%20%20%20%3C!--%E4%BD%9C%E4%B8%BA%E8%B5%84%E6%BA%90%E6%9C%8D%E5%8A%A1%E5%99%A8--%3E%0A%20%20%20%20%20%20%20%20%3Cdependency%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.springframework.cloud%3C%2FgroupId%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Espring-cloud-starter-security%3C%2FartifactId%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3Cversion%3E2.1.4.RELEASE%3C%2Fversion%3E%0A%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%0A%20%20%20%20%20%20%20%20%3Cdependency%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.springframework.security.oauth.boot%3C%2FgroupId%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Espring-security-oauth2-autoconfigure%3C%2FartifactId%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3Cversion%3E2.1.4.RELEASE%3C%2Fversion%3E%0A%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%0A%20%20%20%20%20%20%20%20%3Cdependency%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Emysql%3C%2FgroupId%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Emysql-connector-java%3C%2FartifactId%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3Cscope%3Eruntime%3C%2Fscope%3E%0A%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%0A%20%20%20%20%20%20%20%20%3Cdependency%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.springframework.boot%3C%2FgroupId%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Espring-boot-starter-test%3C%2FartifactId%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%3Cscope%3Etest%3C%2Fscope%3E%0A%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%0A%60%60%60%0A%0A%23%23%23%23%20%E9%85%8D%E7%BD%AE%E4%B8%80%E4%BA%9B%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF%E7%B3%BB%0A%0A%60%60%60yaml%0Aeureka%3A%0A%20%20client%3A%0A%20%20%20%20service-url%3A%0A%20%20%20%20%20%20defaultZone%3A%20http%3A%2F%2Flocalhost%3A8761%2Feureka%2F%0Aserver%3A%0A%20%20port%3A%208762%0Aspring%3A%0A%20%20application%3A%0A%20%20%20%20name%3A%20service-hi%0A%20%20datasource%3A%0A%20%20%20%20driver-class-name%3A%20com.mysql.jdbc.Driver%0A%20%20%20%20url%3A%0A%20%20%20%20username%3A%0A%20%20%20%20password%3A%0A%0A%20%20jpa%3A%0A%20%20%20%20hibernate%3A%0A%20%20%20%20%20%20ddl-auto%3A%20update%0A%20%20%20%20show-sql%3A%20true%0A%23%20%20%20%20%E4%B8%8B%E9%9D%A2%E7%9A%84%E9%85%8D%E7%BD%AE%E9%9C%80%E8%A6%81%E5%92%8C%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E8%80%85auth%E4%B8%AD%E7%9A%84%E9%85%8D%E7%BD%AE%E4%BF%9D%E6%8C%81%E4%B8%80%E8%87%B4%EF%BC%8C%E9%9C%80%E8%A6%81%E4%B8%8E%E4%B9%8B%E4%B8%80%E4%B8%80%E5%AF%B9%E5%BA%94%0Asecurity%3A%0A%20%20oauth2%3A%0A%20%20%20%20resource%3A%0A%20%20%20%20%20%20user-info-uri%3A%20http%3A%2F%2Flocalhost%3A5000%2Fuaa%2Fusers%2Fcurrent%0A%20%20%20%20client%3A%0A%20%20%20%20%20%20client-id%3A%20service-hi%0A%20%20%20%20%20%20client-secret%3A%20123456%0A%20%20%20%20%20%20access-token-uri%3A%20http%3A%2F%2Flocalhost%3A5000%2Fuaa%2Foauth%2Ftoken%0A%20%20%20%20%20%20grant-type%3A%20client_credentials%2Cpassword%0A%20%20%20%20%20%20scope%3A%20server%0A%0A%60%60%60%0A%0A%23%23%23%23%20%E9%85%8D%E7%BD%AEResource%20%20Server%0Aservice-hi%E4%BD%9C%E4%B8%BA%E8%B5%84%E6%BA%90%E6%9C%8D%E5%8A%A1%EF%BC%8C%E9%9C%80%E8%A6%81%E9%85%8D%E7%BD%AEResource%20Server%E7%9A%84%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE%0A%60%60%60java%0A%0A%40Configuration%0A%40EnableResourceServer%2F%2F%E5%BC%80%E5%90%AFResource%20Server%E5%8A%9F%E8%83%BD%0A%40EnableGlobalMethodSecurity(prePostEnabled%20%3D%20true)%2F%2F%E5%BC%80%E5%90%AF%E6%96%B9%E6%B3%95%E7%BA%A7%E5%88%AB%E7%9A%84%E4%BF%9D%E6%8A%A4%0Apublic%20class%20ResourceServerConfigurer%20extends%20ResourceServerConfigurerAdapter%20%7B%0A%20%20%20%20%40Override%0A%20%20%20%20public%20void%20configure(HttpSecurity%20http)%20throws%20Exception%20%7B%0A%0A%20%20%20%20%20%20%20%20http.authorizeRequests()%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.antMatchers(%22%2Fuser%2Fregistry%22).permitAll()%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.anyRequest().authenticated()%3B%2F%2F%E8%BF%99%E9%87%8C%E9%85%8D%E7%BD%AE%E7%9A%84%E6%98%AF%2Fuser%2Fregistry%2F%E7%9A%84%E8%AF%B7%E6%B1%82%E4%B8%8D%E9%9C%80%E8%A6%81%E9%AA%8C%E8%AF%81%EF%BC%8C%E5%85%B6%E5%AE%83%E7%9A%84%E9%83%BD%E9%9C%80%E8%A6%81%E9%AA%8C%E8%AF%81%0A%20%20%20%20%7D%0A%7D%0A%60%60%60%0A%0A%23%23%23%23%20%E9%85%8D%E7%BD%AEOAuth2%20Client%0A%0A%60%60%60java%0A%0A%40EnableOAuth2Client%0A%40EnableConfigurationProperties%0A%40Configuration%0Apublic%20class%20OAuthClientConfig%20%7B%0A%20%20%20%20%2F*%0A%20%20%20%20%20*1.%20%E9%85%8D%E7%BD%AE%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E6%BA%90%E7%9A%84%E4%BF%A1%E6%81%AF%0A%20%20%20%20%20*2.%20%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AA%E8%BF%87%E6%BB%A4%E5%99%A8%EF%BC%8C%E5%AD%98%E5%82%A8%E5%BD%93%E5%89%8D%E8%AF%B7%E6%B1%82%E5%92%8C%E4%B8%8A%E4%B8%8B%E6%96%87%0A%20%20%20%20%20*3.%20Request%E5%9F%9F%E4%B8%AD%E5%88%9B%E5%BB%BAAccessTokenRequest%E7%B1%BB%E5%9E%8B%E7%9A%84Bean%0A%20%20%20%20%20*%20*%2F%0A%20%20%20%20%40Bean%0A%20%20%20%20%40ConfigurationProperties(prefix%20%3D%20%22security.oauth2.client%22)%0A%20%20%20%20public%20ClientCredentialsResourceDetails%20clientCredentialsResourceDetails()%20%7B%0A%20%20%20%20%20%20%20%20return%20new%20ClientCredentialsResourceDetails()%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%40Bean%0A%20%20%20%20public%20RequestInterceptor%20oauth2FeignRequestInterceptor()%20%7B%0A%20%20%20%20%20%20%20%20return%20new%20OAuth2FeignRequestInterceptor(new%20DefaultOAuth2ClientContext()%2C%20clientCredentialsResourceDetails())%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%40Bean%0A%20%20%20%20public%20OAuth2RestTemplate%20clientCredentialsRestTemplate()%20%7B%0A%20%20%20%20%20%20%20%20return%20new%20OAuth2RestTemplate(clientCredentialsResourceDetails())%3B%0A%20%20%20%20%7D%0A%0A%7D%0A%0A%60%60%60%0A%0A%E8%BF%99%E6%A0%B7%E5%9F%BA%E6%9C%AC%E7%9A%84%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E5%B0%B1%E5%AE%8C%E6%88%90%E4%BA%86</center></span>
</div></body></html> 