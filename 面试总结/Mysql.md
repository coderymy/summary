# 概念

## 锁

**按照范围划分**

+ 全局锁：锁住的是整个数据库实例，在进行全库逻辑备份的时候使用`flush tables with read lock`
+ 表级锁：锁住的是整个表，lock tables xx read
+ 行级锁：锁住的是该条记录。DML语句、for update、串行化等

**按照锁的功能划分**

行锁：

+ 记录锁：锁住的是一条记录。
+ 间隙锁：锁住的是查询的范围，左开右开的区间，
+ 临键锁：对于非唯一索引，锁住的是间隙+记录。

对于唯一索引：

查询到数据就是记录锁。未查询到记录就是范围锁

对于非唯一索引：

等值查找，找到记录就是临键锁、未找到就是间隙锁。范围查找临键锁。



## 事务

**ACID**

原子性、一致性、隔离性、持久性

**事务的并发问题**

+ 脏读：读取到了别的事务没有提交的数据
+ 幻读：范围操作，在事务期间出现了范围内的数据变更，导致该事物操作的数据不完整。
+ 不可重复读：在一次事务中两次读取到的数据不一致。

**解决方案及隔离级别**

读未提交：可以读到未提交事务修改的数据，没有解决任何问题

读已提交：只会读到别的事务提交了的数据，解决了脏读的问题。

可重复读：读取数据期间，不会因为多次读取而不一致。使用MVCC解决不可重复读的问题（相当于事务开启的时候对获取到的数据建立一个快照readView）。使用间隙锁解决幻读的问题。

串行化：各个事务操作都是串行处理，不会出现并发问题。



**简述MVCC**

+ 进行DML语句操作的时候，根据undolog生成版本链
+ 开启事务的时候，使用快照读，并根据版本链生成该快照读的readview数据
+ 当前事务操作的时候，只是操作readview中版本链上的数据。

在RR的时候，是在开启事务的时候生成一个版本链。RC的时候是在每次进行select的时候生成版本链，操作的也就是该版本链之前的数据。



## 索引

基本了解，不需要整理

## redolog、undolog和binlog

redolog是指数据库进行DML操作的时候，并不是实时写入磁盘的，而是先写入redolog。然后对四个redolog文件循环刷来写入磁盘。

WAL机制：就是指进行数据库操作并不是直接写入磁盘。

undolog：用来支持MVCC操作的，每次写入数据库的时候都生成一条对应的回滚语句。并不是相反的语句，而是对应的回滚操作语句。用来构建版本链

binlog：实现写时复制，主从同步等。是server层（undolog和redolog都是引擎层面的）



