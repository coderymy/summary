# Cancel是什么

> 首先看官方的简介:
![](https://camo.githubusercontent.com/63881e271f889d4a424c55cea2f9c2065f63494fecac58432eac415f6e47e959/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303139313130343130313733353934372e706e67)
canal [kə'næl]，译意为水道/管道/沟渠，主要用途是基于 MySQL 数据库增量日志解析，提供增量数据订阅和消费<br/>
早期阿里巴巴因为杭州和美国双机房部署，存在跨机房同步的业务需求，实现方式主要是基于业务 trigger 获取增量变更。从 2010 年开始，业务逐步尝试数据库日志解析获取增量变更进行同步，由此衍生出了大量的数据库增量订阅和消费业务。<br/>
基于日志增量订阅和消费的业务包括
> <br/>数据库镜像
数据库实时备份
索引构建和实时维护(拆分异构索引、倒排索引等)
业务 cache 刷新
带业务逻辑的增量数据处理

首先,canal这个单词的意思是“运河”
其实第一次看到,我并不能理解为什么比做成管道.但是我忽然想到了我们项目线上遇到的一个场景:

> 1. 业务部门要求修改某个产品的价格,这个价格在mysql中存储,我们以前修改mysql之后,还需要按照这个产品的id信息去删除redis缓存中的数据.这样其实会带来很多问题,因为是人为手动操作,所以会有很多问题
> 2. 线上统计信息的时候,并不能做到实时根据数据库的数据变换形成统计.因为服务器不能进行感知修改


所以就我自己总结,canal就是一个可以感知到mysql的数据变换的一个工具,这个工具提供了很多API的方式来与MQ或者是Java服务进行交互,从而达到一种可以通知到相关服务的功能实现.

线上一般我们的作用就是
1. 业务cache刷新
2. 数据库实时备份(需要数据处理的备份)


# canal的原理 

其实就官方说,canal的原理很简单,大家都知道mysql的主从复制原则吧,就是
1. master-mysql开启了binlog操作
2. salve-mysql获取(请求dump到master-mysql)binary log event到中继日志中
3. salve-mysql进行日志的处理同步到自己的mysql中

canal-serve就将自己伪装成master-mysql的一个slave-mysql,进行增删改的log日志同步.然后canal-client会订阅数据修改,进行处理

# canal的集群模式


1. 首先canal多台之间是主备的模式,也就是同一时间,只有一台存活着进行数据处理,如果这台挂掉了,才会启动下一台
2. 多台canal之间,使用zookeeper进行管理.
3. 其次zookeeper也是集群模式

然后一般是3z2c模式,也就是三台zookeeper和两台canal-serve

