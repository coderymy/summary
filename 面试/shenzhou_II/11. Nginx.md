# 1. 简述

# 2. 基本命令

**检查配置文件格式是否正确**

```bash
 ./nginx -t
 
 # -c表示指定配置文件
 ./nginx -t -c /usr/local/nginx/conf/nginx.conf
```

**重新加载配置文件**

```bash
./nginx -s reload
```



# 3. 配置

## 使用外部引用文件

原生的文件这么写的

```conf

worker_processes  1;
error_log  logs/error.log;
events {
    worker_connections  1024;
}
http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    keepalive_timeout  65;

    upstream wechat-mp {   
        server localhost:8888 max_fails=2 fail_timeout=5s;
        keepalive 300;
    } 
    server {
        #SSL 访问端口号为 443
        listen 443 ssl; 
        listen       80;
        #填写绑定证书的域名
        server_name coderymy.cn; 
        #证书文件名称
        ssl_certificate coderymy.cn_bundle.crt; 
        #私钥文件名称
        ssl_certificate_key coderymy.cn.key; 
        ssl_session_timeout 5m;
        #请按照以下协议配置
        ssl_protocols TLSv1.2 TLSv1.3; 
        #请按照以下套件配置，配置加密套件，写法遵循 openssl 标准。
        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE; 
        ssl_prefer_server_ciphers on;
        location ^~ /wechat-mp/ {
            proxy_pass http://wechat-mp;
        }
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
    }
}

```

1. 创建对应的serverName.conf文件

   其中写入的是`server`的配置信息

   ```json
   server {
           #SSL 访问端口号为 443
           listen 443 ssl; 
           listen       80;
           #填写绑定证书的域名
           server_name coderymy.cn; 
           #证书文件名称
           ssl_certificate coderymy.cn_bundle.crt; 
           #私钥文件名称
           ssl_certificate_key coderymy.cn.key; 
           ssl_session_timeout 5m;
           #请按照以下协议配置
           ssl_protocols TLSv1.2 TLSv1.3; 
           #请按照以下套件配置，配置加密套件，写法遵循 openssl 标准。
           ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE; 
           ssl_prefer_server_ciphers on;
           location ^~ /wechat-mp/ {
               proxy_pass http://wechat-mp;
           }
           error_page   500 502 503 504  /50x.html;
           location = /50x.html {
               root   html;
   }
   ```

2. 创建`upstream.conf`文件

   ```
   upstream wechat-mp {   
       server localhost:8888 max_fails=2 fail_timeout=5s;
       keepalive 300;
   }
   ```

3. 在启动配置文件中删除原本信息，并使用`include`引入文件

   ```json
   worker_processes  1;
   error_log  logs/error.log;
   events {
       worker_connections  1024;
   }
   http {
       include       mime.types;
       default_type  application/octet-stream;
       sendfile        on;
       keepalive_timeout  65;
   
       include vhosts/*.conf;
       include upstream.conf;
   }
   ```





## 附：配置文件复本

```json
#user  nobody;
# 工作线程 一般小于CPU个数
worker_processes  1;
# 错误日志保存位置
#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;
# 进程号保存文件
#pid        logs/nginx.pid;
# 每个进程的最大连接数（最大连接数=worker_processes*worker_connections）
events {
    worker_connections  1024;
}

# 配置代理，缓存，日志定义等绝大多数功能和第三方模块的配置。
http {
    # 文件扩展名与文件类型的映射表
    include       mime.types;
    # 默认文件类型
    default_type  application/octet-stream;
     
    # 文件的输出格式
    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
    #                  '$status $body_bytes_sent "$http_referer" '
    #                  '"$http_user_agent" "$http_x_forwarded_for"';
    # 请求日志保存位置
    #access_log  logs/access.log  main;
    # 打开发送文件
    sendfile        on;
    #tcp_nopush     on;
    
    # 连接超时时间限制
    keepalive_timeout  65;
    # 使用gzip压缩
    #gzip  on;
    
    # 配置虚拟主机，基于域名、ip和端口
    server {
        # 监听外部访问的端口。也就是这个端口的请求被这个server捕捉
        listen       80;
        # 监听的域名，localhost表示全部域名都监听
        server_name  localhost;
        #charset koi8-r;
        # 访问日志保存路径
        #access_log  logs/host.access.log  main;
        # 监听访问路径，正则的方式
        location / {
            root   html;
            index  index.html index.htm;
        }
        #error_page  404              /404.html;
        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
        # proxy the PHP scripts to Apache listening on 127.0.0.1:80
        #
        #location ~ \.php$ {
        #    proxy_pass   http://127.0.0.1;
        #}
        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
        #
        #location ~ \.php$ {
        #    root           html;
        #    fastcgi_pass   127.0.0.1:9000;
        #    fastcgi_index  index.php;
        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
        #    include        fastcgi_params;
        #}
        # deny access to .htaccess files, if Apache's document root
        # concurs with nginx's one
        #
        #location ~ /\.ht {
        #    deny  all;
        #}
    }
    # another virtual host using mix of IP-, name-, and port-based configuration
    #
   server{
       listen 8888;
       server_name localhost;
       location ~ /wechat-mp/{
           proxy_pass http://127.0.0.1:8888;
       }
   }
    server {
        #SSL 访问端口号为 443
        listen 443 ssl; 
        #填写绑定证书的域名
        server_name coderymy.cn; 
        #证书文件名称
        ssl_certificate coderymy.cn_bundle.crt; 
        #私钥文件名称
        ssl_certificate_key coderymy.cn.key; 
        ssl_session_timeout 5m;
        #请按照以下协议配置
        ssl_protocols TLSv1.2 TLSv1.3; 
        #请按照以下套件配置，配置加密套件，写法遵循 openssl 标准。
        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE; 
        ssl_prefer_server_ciphers on;
        location / {
           #网站主页路径。此路径仅供参考，具体请您按照实际目录操作。
           #例如，您的网站运行目录在/etc/www下，则填写/etc/www。
            root html; 
            index  index.html index.htm;
        }
    }
}

```







# 注意点

## https和http的默认端口分别是443，80

也就是说如果不带上:ports。使用https://www.baidu.com实际访问的是`www.baidu.com:443`服务。使用`http://www.baidu.com`实际访问的是`www.baidu.com:80`服务