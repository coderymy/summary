# 1. MyISAM和INNODB区别

InnoDb经过屡次优化,其实已经完全可以站在myIsam前面了

innoDb的优点

+ 支持事务
+ 支持表级锁,行级锁
+ 支持外键
+ 不会产生空间碎片

myIsam的优点

+ 支持全文索引

# 2. mysql的索引

> 数据结构

B+树

```
特性:
索引和数据是分开的,使用的是一个树形结构和一个链表组成

作为mysql的索引类型优点:
1. 磁盘读写代价更低(指针和数据是分开存储的)
由于索引和数据是分开的,所以只需要从磁盘读入索引信息,这样可以一次读入更多的信息,防止重复的进行此磁盘的IO操作
2. 查询效率更加稳定(所有数据只需要走一趟即可获取)
所以任何关键字的查找必须走一条从根结点到叶子结点的路。所有关键字查询的路径“长度相同”，导致每一个数据的查询效率相当。
```

hash树

```
普通的查找方式速度快,但是如果遇到范围性查找就不行了
```

> 索引类型的划分

全文索引

唯一索引

主键索引

组合索引

普通索引



# 3. 锁类型

mysql锁分为共享锁(读锁)和排他锁(写锁)

共享锁,指锁情况下,允许进行其他的读操作.不允许写操作

排他锁,会阻塞其他的写锁和读锁

+ 表锁:会锁定整张表数据,在alter的时候会发生这个情况

+ 行锁

  + 悲观锁,顾名思义很悲观,每次进行数据操作的时候,都会加锁

    ```
    假设丢失更新一定存在；sql后面加上for update；这是数据库的一种机制。
    ```

  + 乐观锁

    认为操作的数据不会同时被别人操作,所以不会加锁,只是会执行后检查是否有存在修改的版本信息



# 4. 事务的四大特性和隔离级别

> 四个基本特性

1. 原子性:要么全部执行，要么全部不执行；
2. 一致性:事务的执行使得数据库从一种正确状态转化为另一种正确状态；
3. 隔离性:在事务正确提交之前，不允许把该事务对数据的任何改变提供给其他事务；
4. 持久性:事务提交后，其结果永久保存在数据库中。

```
对应四大特性的实现方式
原子性:使用undo log实现,原理就是
1. 在操作任何数据之前,都先将数据备份到另一个地方(这个地方称之为undo log)
2. 然后就行数据修改
3. 如果出现异常或者执行了rollback操作,系统就使用undo log中的数据将数据恢复到事物执行之前的状态

持久性:使用的redo log实现的,原理就是
1. 操作任何数据的时候,都将操作之后的数据进行备份到一个地方(这个地方就叫做redo log)
2. 事务提交之前将redo log持久化
3. 如果 系统出现崩溃则可以直接使用redo log恢复数据

隔离性:通过加锁和MVCC去实现的
```



> 事务隔离级别

```
读未提交
读已提交---3
可重复读---23
串行化---123

READ_UNCOMMITTED（读未提交）: 最低的隔离级别，允许读取尚未提交的数据变更，可能会导致脏读、幻读或不可重复读
READ_COMMITTED（读已提交）: 允许读取并发事务已经提交的数据，可以阻止脏读，但是幻读或不可重复读仍有可能发生
REPEATABLE_READ（可重复读）: 对同一字段的多次读取结果都是一致的，除非数据是被本身事务自己所修改，可以阻止脏读和不可重复读，但幻读仍有可能发生。
SERIALIZABLE（串行）: 最高的隔离级别，完全服从ACID的隔离级别。所有的事务依次逐个执行，这样事务之间就完全不可能产生干扰，也就是说，该级别可以防止脏读、不可重复读以及幻读。但是这将严重影响程序的性能。通常情况下也不会用到该级别。

解决问题，1. 脏读。2. 不可重复读。3. 幻读
```

> 四个特性如何保证

原子性由undo log日志保证，它记录了需要回滚的日志信息，事务回滚时撤销已经执行成功的sql

一致性一般由代码层面来保证

隔离性由MVCC来保证

持久性由内存+redo log来保证，mysql修改数据同时在内存和redo log记录这次操作，事务提交的时候通过redo log刷盘，宕机的时候可以从redo log恢复



# 5. Undo log 和redo log

与事务有关的

undo log(记录的是原始数据) 、就是执行事务操作之前会将原始数据备份到log日志中.然后再进行数据修改,如果修改失败,这个时候就可以使用undo log进行数据恢复.**记录的是修改数据的原始数据**

redo log(记录的是新更新后的数据)、记录的是该事务更新的数据,也就是说需要更新的数据.在事务提交之前只需要持久化redo log即可,不需要持久化数据.



脏读

可重复读

多版本事务





jvm+mysql